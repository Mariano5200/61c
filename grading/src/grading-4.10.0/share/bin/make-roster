#!/usr/bin/env perl
# -*- mode: Perl;-*-
# Version @VERSION@
# See the file COPYING in the main distribution directory for copyright notice.

unshift (@INC, '@LIBDIR@');
require "GradingBase.pl";
CmndLine ("o:", 0, 1);
require "GradingCommon.pl";

$me = MyLogin ();

ReaderExists ($me)
    || Fatal ("You are not registered as a reader for $COURSE.");

open (ROSTER, $MAIN_ROSTER) 
    || Fatal ("Could not read main roster file: ($!)\n"
	      . "The class master probably has to run make-main-roster.");

if ($opt_o) {
    if (-e $opt_o && ! Yorn ("Overwrite $opt_o? ")) {
	Fatal ("Command terminated.");
    }
    open (STDOUT, ">$opt_o") 
	|| Fatal ("Could not open $opt_o: $!");
}

$assgn = shift;

$mine = $READER_ASSIGNMENTS{$me};

while (<ROSTER>) {
    if ((($login, $last, $first, $SID) = /^\s*(\S+)\s+(\S+)\s+(\S+)\s+(\S+)/)
	&& (! $assgn || ("${assgn}::$login" =~ /$mine/o))) {
	print "$login ${first}_$last \n";
    }
}

exit 0;
